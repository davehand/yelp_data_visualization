<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Used for Google+ Sign in -->
    <meta name="google-signin-clientid" content="9623654849-crp8t34rpcaeukbsbri3spv8v7qvsbjo.apps.googleusercontent.com" />
    <meta name="google-signin-scope" content="https://www.googleapis.com/auth/plus.login" />
    <meta name="google-signin-requestvisibleactions" content="http://schema.org/AddAction" />
    <meta name="google-signin-cookiepolicy" content="single_host_origin" />
    
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">    
    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static "yelpviz/map.css" %}">

    <script 
      type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBAw0e_FoeYsU00AS1QBNmhwa2k__QJWV0">
    </script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://apis.google.com/js/client:platform.js?onload=render" async defer></script>

    <!-- GOOGLE MAPS -->
    <script type="text/javascript">
      var overlay;
      USGSOverlay.prototype = new google.maps.OverlayView();

      /* initializes a Google map */
      function initialize() {
        init_map()
      }

      /* initialize a map with geoJSON data */
      function init_map() {
        var mapOptions = {
          minZoom: 5,
          maxZoom: 7,
          center: {lat: 38.8282, lng: -97},
          zoom: 5
        };
        window.map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);

        //var swBound = new google.maps.LatLng(38.8282 - 10, -97 - 10);
        //var neBound = new google.maps.LatLng(38.8282 + 10, -97 + 10);
        var swBound = new google.maps.LatLng(23.7, -129.3);
        var neBound = new google.maps.LatLng(49.5, -65.3);
        var bounds = new google.maps.LatLngBounds(swBound, neBound);

        var srcImage = '{% static "yelpviz/tmp.png" %}';

        // The custom USGSOverlay object contains the USGS image,
        // the bounds of the image, and a reference to the map.
        overlay = new USGSOverlay(bounds, srcImage, window.map);
      }
      
      /** @constructor */
      function USGSOverlay(bounds, image, map) {

        // Initialize all properties.
        this.bounds_ = bounds;
        this.image_ = image;
        this.map_ = map;

        // Define a property to hold the image's div. We'll
        // actually create this div upon receipt of the onAdd()
        // method so we'll leave it null for now.
        this.div_ = null;

        // Explicitly call setMap on this overlay.
        this.setMap(map);
      }

      /**
       * onAdd is called when the map's panes are ready and the overlay has been
       * added to the map.
       */
      USGSOverlay.prototype.onAdd = function() {

        var div = document.createElement('div');
        div.style.borderStyle = 'none';
        div.style.borderWidth = '0px';
        div.style.position = 'absolute';

        // Create the img element and attach it to the div.
        var img = document.createElement('img');
        img.src = this.image_;
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.position = 'absolute';
        div.appendChild(img);

        this.div_ = div;

        // Add the element to the "overlayLayer" pane.
        var panes = this.getPanes();
        panes.overlayLayer.appendChild(div);
      };

      USGSOverlay.prototype.draw = function() {

        // We use the south-west and north-east
        // coordinates of the overlay to peg it to the correct position and size.
        // To do this, we need to retrieve the projection from the overlay.
        var overlayProjection = this.getProjection();

        // Retrieve the south-west and north-east coordinates of this overlay
        // in LatLngs and convert them to pixel coordinates.
        // We'll use these coordinates to resize the div.
        var sw = overlayProjection.fromLatLngToDivPixel(this.bounds_.getSouthWest());
        var ne = overlayProjection.fromLatLngToDivPixel(this.bounds_.getNorthEast());

        // Resize the image's div to fit the indicated dimensions.
        var div = this.div_;
        div.style.left = sw.x + 'px';
        div.style.top = ne.y + 'px';
        div.style.width = (ne.x - sw.x) + 'px';
        div.style.height = (sw.y - ne.y) + 'px';
      };

      // The onRemove() method will be called automatically from the API if
      // we ever set the overlay's map property to 'null'.
      USGSOverlay.prototype.onRemove = function() {
        this.div_.parentNode.removeChild(this.div_);
        this.div_ = null;
      };
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    <script src="{% static "yelpviz/login.js" %}"></script>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">YelpViz</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
          </ul>
        </div>
      </div>
    </nav>


    <div id="map-canvas"></div>
    <div id="login">
      <div id="google-login-details">
        <a id="google-logout-button"
          onclick="googleLogout()"
          display="none"
          href="#" 
          class="btn btn-success btn-xs">
          <span class="glyphicon glyphicon-user">
          </span> 
          Logout
        </a>
        <div id="google-login-button"></div>
      </div>

      <div id="fb-login-details">
        <!-- Facebook login button -->
        <fb:login-button autologoutlink="true" onlogin="checkLoginState()"></fb:login-button>
        <div id="fb-root"></div>
        <div id="fb-logged-in-gui" display="none">
          <!-- Facebook login status -->
          <div id="fb-status"></div>
          <div id="fb-actions"
            class="fb-like"
            data-share="true"
            data-width="100"
            layout="button_count">
          </div>
        </div>
      </div>

      <!-- User information -->
      <div id="userinfo">
        <img id="profile-pic" style="width:50px" display="none">
      </div>
    </div>
  </body>
</html>
